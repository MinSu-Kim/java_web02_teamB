<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.yi.food_mgm_program.dao.MemberMapper">
	
	<resultMap type="Member" id="resultMember">
		<id column="mb_no" property="mbNo"/>
		<result column="mb_name" property="mbName"/>
		<result column="mb_birth" property="mbBirth"/>
		<result column="mb_tel" property="mbTel"/>
		<result column="mb_mileage" property="mbMileage"/>
		<result column="mb_address" property="mbAddress"/>
	</resultMap>
	
	<resultMap type="Member" id="resultMemberBJY" extends="resultMember">
		<association property="mbGrade" resultMap="kr.or.yi.food_mgm_program.dao.GradeMapper.resultGrade"/>
		<collection property="coupon" resultMap="kr.or.yi.food_mgm_program.dao.CouponMapper.resultCouponBJY"/>
	</resultMap>
	
	<select id="selectMemberByAll" resultMap="resultMemberBJY">
		select m.mb_no, m.mb_name, mb_birth, mb_tel, mb_mileage, mb_grade, mb_address, c.cp_no, c.cp_name, cp_discount as cp_discount2
		from member m left join member_coupon mc on m.mb_no = mc.mb_no left join coupon c on mc.cp_no = c.cp_no
	</select>
	
	<insert id="insertMember" parameterType="Member">
		insert into member(mb_name, mb_birth, mb_tel, mb_mileage, mb_grade, mb_address) 
		values (#{mbName},#{mbBirth},#{mbTel},#{mbMileage},#{mbGrade.grade},#{mbAddress})
	</insert>
	
	<select id="selectMemberByTel" resultType="Member" parameterType="Member">
		select * from member where right(mb_tel,8) like concat('%',#{mbTel},'%')
	</select>
	
	<update id="updateMember" parameterType="Member">
		update member set mb_mileage = #{mbMileage}, mb_grade = #{mbGrade.grade}, mb_address = #{mbAddress} where mb_no = #{mbNo};		
	</update>
	
	<delete id="deleteMember" parameterType="Member">
		delete from member where mb_no = #{mbNo}
	</delete>

	<select id="selectMemberByNo" resultType="Member" parameterType="Member">
		select m.mb_name, g.mb_grade, g.g_discount as g_discount2, m.mb_mileage, c.cp_name, c.cp_discount as cp_discount2
		from member m join grade g on m.grade = g.grade join member_coupon mc on m.mb_no = mc.mb_no join coupon c on mc.cp_no = c.cp_no
		where m.mb_no = #{mbNo}
	</select>
	
</mapper>